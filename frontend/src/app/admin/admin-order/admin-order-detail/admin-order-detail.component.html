<div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full" data-sidebar-position="fixed" data-header-position="fixed">
  <div class="body-wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <div class="card">
            <div class="card-body">
              <div class="container mt-4">
                <h2 class="text-center">Chi tiết đơn hàng: {{ order?.orderId }}</h2>

                <!-- Thông tin đơn hàng -->
                <div *ngIf="order; else loadingOrder">
                  <table class="table table-bordered mt-3">
                    <tbody>
                      <tr>
                        <th>Tổng tiền</th>
                        <td>{{ convertCommaToDot(order.total_amount | number:'1.0-0') }} ₫</td>
                      <tr>
                        <th>Trạng thái</th>
                        <td>
                          <span [ngClass]="getStatusClass(order.status)">
                            {{ getStatusLabel(order.status) }}
                          </span>
                        </td>
                      </tr>
                      <tr>
                        <th>Phương thức thanh toán</th>
                        <td>{{ order.payment_method }}</td>
                      </tr>
                      <tr>
                        <th>Họ và tên khách hàng</th>
                        <td>{{ order.fullname }}</td>
                      </tr>
                      <tr>
                        <th>Số điện thoại</th>
                        <td>{{ order.phone_number }}</td>
                      </tr>
                      <tr>
                        <th>Địa chỉ</th>
                        <td>{{ order.address }}</td>
                      </tr>
                      <tr>
                        <th>Ghi chú</th>
                        <td>{{ order.note || 'Không có ghi chú' }}</td>
                      </tr>
                      <tr>
                        <th>Mã giảm giá</th>
                        <td>{{ order.voucher_code || 'Không có' }}</td>
                      </tr> 
                      <tr>
                        <th>Giá trị mã giảm giá</th>
                        <td>{{ order.voucher_discount ? (order.voucher_discount + '%') : 'Không có' }}</td>
                      </tr>
                      <tr>
                        <th>Ngày tạo đơn</th>
                        <td>{{ order.created_at | date:'dd/MM/yyyy HH:mm' }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Loading thông tin đơn hàng -->
                <ng-template #loadingOrder>
                  <p>Đang tải dữ liệu đơn hàng...</p>
                </ng-template>

                <!-- Danh sách chi tiết sản phẩm -->
                <h3 class="mt-4">Danh sách sản phẩm</h3>
                <div *ngIf="orderItems.length > 0; else noDetails">
                  <table class="table table-striped table-bordered mt-3">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Tên sản phẩm</th>
                        <th>Số lượng</th>
                        <th>Đơn giá</th>
                        <th>Thành tiền</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let detail of orderItems; index as i">
                        <td>{{ i + 1 }}</td>
                        <td>{{ detail.product_name }}</td>
                        <td>{{ detail.quantity }}</td>
                        <td>{{ convertCommaToDot(detail.unit_price | number:'1.0-0') }} ₫</td>
                        <td>{{ convertCommaToDot(detail.total_price | number:'1.0-0') }} ₫</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Không có chi tiết sản phẩm -->
                <ng-template #noDetails>
                  <p>Không có chi tiết nào cho đơn hàng này.</p>
                </ng-template>

                <!-- Nút quay lại -->
                <button class="btn btn-secondary mt-3" routerLink="/admin/order">Quay lại danh sách</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
