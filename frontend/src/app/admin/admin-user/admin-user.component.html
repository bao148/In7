<div
  class="page-wrapper"
  id="main-wrapper"
  data-layout="vertical"
  data-navbarbg="skin6"
  data-sidebartype="full"
  data-sidebar-position="fixed"
  data-header-position="fixed"
>
  <div class="body-wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <div class="d-flex justify-content-between align-items-center mt-2">
            <h3 class="mb-0">DANH SÁCH TÀI KHOẢN</h3>
            <a class="btn btn-success" routerLink="add/">Thêm tài khoản</a>
          </div>

          <div class="d-flex align-items-center mt-3 mb-3">
            <label for="statusFilter" class="mr-2">LỌC:</label>
            <input
              type="text"
              class="form-control simple-search-input mr-3"
              style="width: 230px;"
              placeholder="Tìm theo tên..."
              [(ngModel)]="searchTerm"
              (input)="filterUsers()"
            />
            <div class="mr-3 d-flex align-items-center">
              <select
                class="form-control"
                [(ngModel)]="selectedStatus"
                (change)="filterUsers()"
              >
                <option value="">Tất cả trạng thái ⌵ </option>
                <option value="active">Hoạt động</option>
                <option value="inactive">Không hoạt động</option>
              </select>
            </div>
            <div class="d-flex align-items-center">
              <select
                class="form-control"
                [(ngModel)]="selectedRole"
                (change)="filterUsers()"
              >
                <option value="">Tất cả vai trò ⌵</option>
                <option value="admin">Quản trị viên</option>
                <option value="user">Người dùng</option>
              </select>
            </div>
          </div>          

          <div class="card mt-3">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover table-bordered text-nowrap">
                  <thead class="table-dark text-white text-center align-middle">
                    <tr>
                      <th scope="col" class="py-3">STT</th>
                      <th scope="col" class="py-3">Tên người dùng</th>
                      <th scope="col" class="py-3">Hình ảnh</th>
                      <th scope="col" class="py-3">Số điện thoại</th>
                      <th scope="col" class="py-3">Email</th>
                      <th scope="col" class="py-3">Vai trò</th>
                      <th scope="col" class="py-3">Trạng thái</th>
                      <th scope="col" class="py-3">Thao tác</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                    *ngFor="let user of getPagedData()"
                    [ngClass]="{
                      'table-light': user.Status === 'active',
                      'table-danger': user.Status !== 'active'
                    }"
                  >
                    <th scope="row" class="text-center align-middle">{{ user.UserID }}</th>
                    <td class="align-middle text-truncate" style="max-width: 150px;">
                      {{ user.FullName }}
                    </td>
                    <td class="text-center align-middle">
                      <img
                        [src]="getImageUrl(user.ProfilePicture)"
                        alt="{{ user.FullName }}"
                        class="img-thumbnail"
                        style="max-width: 60px; height: auto;"
                      />
                    </td>
                    <td class="align-middle text-center">{{ user.PhoneNumber }}</td>
                    <td class="align-middle text-truncate" style="max-width: 200px;">
                      {{ user.Email }}
                    </td>
                    <td class="align-middle text-center">{{ getRoleLabel(user.Role) }}</td>
                    <td class="align-middle text-center">
                      <span
                        class="badge"
                        [ngClass]="{
                          'bg-success': user.Status === 'active',
                          'bg-danger': user.Status !== 'active'
                        }"
                      >
                        {{ getStatusLabel(user.Status) }}
                      </span>
                    </td>
                    <td class="text-center align-middle">
                      <div class="d-flex justify-content-center align-items-center gap-2">
                        <a
                          [routerLink]="'edit/' + user.UserID"
                          class="btn btn-sm btn-info"
                        >
                          Sửa
                        </a>
                        <button
                          type="button"
                          class="btn btn-sm btn-danger"
                          (click)="openDeleteModal(user.UserID, user.Email, user.FullName)"
                        >
                          Xóa
                        </button>
                      </div>
                    </td>
                  </tr>
                  
                  </tbody>
                </table>
                
                <div class="d-flex justify-content-center mt-3">
                  <nav>
                    <ul class="pagination">
                      <li class="page-item" [class.disabled]="currentPage === 1">
                        <button class="page-link" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
                          Trước
                        </button>
                      </li>
                      <li class="page-item" *ngFor="let page of getPaginationArray()" [class.active]="page === currentPage">
                        <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
                      </li>
                      <li class="page-item" [class.disabled]="currentPage === getTotalPages()">
                        <button class="page-link" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === getTotalPages()">
                          Tiếp theo
                        </button>
                      </li>
                    </ul>
                  </nav>
                </div>
                
              </div>
            </div>
          </div>
          <div *ngIf="filteredUsers.length === 0" class="text-center mt-3">
            <p class="text-muted">Không tìm thấy kết quả phù hợp.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Nhập lý do xóa -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h5>Xóa người dùng</h5>
        <button type="button" class="close" (click)="closeModal()">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <p>
          Bạn có chắc chắn muốn xóa người dùng "<strong>{{
            userToDelete?.fullName
          }}</strong
          >"?
        </p>
        <label for="deleteReason">Lý do xóa:</label>
        <textarea
          id="deleteReason"
          [(ngModel)]="deleteReason"
          rows="3"
          class="form-control"
        ></textarea>
        <!-- Hiển thị lỗi nếu có -->
        <p *ngIf="deleteReasonError" class="text-danger">
          {{ deleteReasonError }}
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          Hủy
        </button>
        <button type="button" class="btn btn-danger" (click)="deleteUser()">
          Xóa
        </button>
      </div>
    </div>
  </div>
</div>
